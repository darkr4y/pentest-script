#encoding: UTF-8

import urllib2
import re
import socket
import time  

rfile = open('./ip.txt')

wfile = open('./result.csv', 'a+')

for line in rfile:

    opener = urllib2.build_opener()
    time.sleep(0.5)
    opener.addheaders = [('User-Agent', 'Mozilla/6.0 (Linux 5.5; rv:6.0.2) Gecko/20140101 Firefox/6.0.0')]
    req = opener.open('http://reverseip.domaintools.com/search/?q='+line.strip())
    socket.setdefaulttimeout(8)
    responseHtml = req.read()   
    match = re.findall(r'<span title=(.+)</span></td>', responseHtml)
    wfile.write(socket.gethostbyname(line.strip())+','+'\n')

    print line.strip()

    for val in match:
        wfile.write(val+','+'\n')
        wfile.write('\n')        
rfile.close()
wfile.close()
