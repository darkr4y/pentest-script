import sys
import urllib
import urllib2
import re
import time

SITE = "http://www.objectif-securite.ch/en/ophcrack.php"

def post(url, data):  
    req = urllib2.Request(url)  
    data = urllib.urlencode(data)  
    #enable cookie  
    opener = urllib2.build_opener(urllib2.HTTPCookieProcessor())  
    response = opener.open(req, data)  
    return response.read()  

def checkhash(temp_hash):
    global SITE
    d = {'hash':temp_hash}
    r = post(SITE,d)
    #print r
    s = re.findall('<table>(.*?)<\/table>',r)
    ss = re.findall('<b>(.*?)<\/b>',s[0])
    print
    print ss[1]
    print "-------------------------------------------"
    print "By Ma5ter"
    pass

def usage():
    print "Ophcrack NTLM Hash"
    print "Usage: ophcrack.py hash"
    print "Usage: ophcrack.py -f hash-file"
    print "-------------------------------------------"
    print "hash-format: username(current):x32:x32::::"

def main():
    if len(sys.argv) == 2:
        _hash = sys.argv[1]
        checkhash(_hash)
        
    elif len(sys.argv) == 3:
        if (sys.argv[1] == "-f"):
            f = open(sys.argv[2],'r')
            for i in f:
                i = i.strip()
                print i
            pass
        else:
            usage()
            
    else:
        usage()
    pass



if __name__ == "__main__":
    main()
